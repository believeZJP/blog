---
title: Rediså®æˆ˜è¯»ä¹¦ç¬”è®°
date: 2018-12-06 11:32:08
updated: 2018-12-06 11:32:08
tags:
- redis
- æ•°æ®åº“
- è¯»ä¹¦ç¬”è®°
---

## ç›¸å…³æ–‡æ¡£

- [rediså®˜ç½‘](https://redis.io/)
- [redisä¸­æ–‡ä¸‹è½½å®‰è£…](http://www.redis.cn/download.html)
- [redisä¸­æ–‡æ–‡æ¡£](http://www.redis.cn/documentation.html)

å½“ä½ éœ€è¦ä»¥æ¥è¿‘å®æ—¶çš„é€Ÿåº¦è®¿é—®å¿«é€Ÿå˜åŠ¨çš„æ•°æ®æµæ—¶ï¼ŒRedisè¿™æ ·çš„é”®å€¼æ•°æ®åº“å°±æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ã€‚

## å®‰è£…

ä¸‹è½½ã€è§£å‹ã€ç¼–è¯‘Redis

```bash
wget http://download.redis.io/releases/redis-5.0.2.tar.gz
tar xzf redis-5.0.2.tar.gz
cd redis-5.0.2
make
```

æç¤ºé”™è¯¯

```bash
xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun
```

è§£å†³, è¾“å…¥ä»¥ä¸‹å‘½ä»¤:

```bash
xcode-select --install
```

å›è½¦åï¼Œç³»ç»Ÿå¼¹å‡ºä¸‹è½½xcodeï¼Œç‚¹å‡»ç¡®è®¤ï¼Œä¸‹è½½å®Œæˆåå³å¯ã€‚ï¼ˆå®é™…ä¸Šä¸æ˜¯ä¸‹è½½xcodeï¼Œå¯èƒ½ä¸‹è½½xcodeæœ‰å…³æ’ä»¶ï¼Œä¸‹è½½æ—¶é•¿çº¦1åˆ†é’Ÿï¼‰

> åœ¨è¿™é‡Œå‘ç”Ÿä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œç›´æ¥æ‹·è´åˆ°ç»ˆç«¯é‡Œæ‰§è¡Œä¼šæŠ¥é”™æ— æ³•è¯†åˆ«å‚æ•°ï¼Œæ‰‹åŠ¨æ•²äº†ä¸€éå¯ä»¥æ‰§è¡ŒğŸ˜¶ğŸ˜³ğŸ˜³

## å¯åŠ¨

åœ¨rediså®‰è£…ç›®å½•ä¸‹ï¼Œè¿›å…¥srcï¼Œæ‰§è¡Œ`./redis-server`å¯ä»¥çœ‹åˆ°å¯åŠ¨ç”»é¢

å¦å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œåœ¨åŒæ ·ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`./redis-cli`, è¿æ¥æˆåŠŸã€‚

## å®¢æˆ·ç«¯å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤           | ç‰ˆæœ¬             |
|---------------|------------------|
|set key value  |è®¾ç½® key çš„å€¼      |
|get key        |è·å– key çš„å€¼      |
|exists key     |æŸ¥çœ‹æ­¤ key æ˜¯å¦å­˜åœ¨ |
|del key        |åˆ é™¤å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼|
|keys *         |æŸ¥çœ‹æ‰€æœ‰çš„ key     |
|flushall       |æ¶ˆé™¤æ‰€æœ‰çš„ key     |

Redisä¸å…¶ä»–è½¯ä»¶çš„ç›¸åŒä¸ä¸åŒ

Redisæ˜¯ä¸€ä¸ªè¿œç¨‹å†…å­˜æ•°æ®åº“ï¼Œå…·æœ‰å¤åˆ¶ç‰¹æ€§åŠæœªè§£å†³é—®é¢˜è€Œå‡é«˜çš„ç‹¬ä¸€æ— äºŒçš„æ•°æ®æ¨¡å‹ã€‚

Redisæä¾›äº†5ç§ä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå„ç§é—®é¢˜éƒ½å¯æ˜ å°„åˆ°è¿™äº›æ•°æ®ç»“æ„ã€‚

## redisç®€ä»‹

## redisæ˜¯ä»€ä¹ˆ

Redis æ˜¯ä¸€ä¸ªé€Ÿåº¦éå¸¸å¿«çš„éå…³ç³»æ•°æ®åº“(non-relational database), å¯ä»¥å­˜å‚¨é”®(key)ä¸5ç§ä¸åŒç±»å‹çš„å€¼ä¹‹é—´çš„æ˜ å°„(mapping), å¯ä»¥å°†å­˜å‚¨åœ¨å†…å­˜çš„é”®å€¼å¯¹æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œè¿˜å¯ä»¥é€šè¿‡å¤åˆ¶ï¼ŒæŒä¹…åŒ–å’Œå®¢æˆ·ç«¯åˆ†ç‰‡ç­‰ç‰¹æ€§ï¼Œå¯ä»¥å°†redisæ‰©å±•æˆä¸€ä¸ªèƒ½å¤ŸåŒ…å«æ•°ç™¾GBæ•°æ®ã€æ¯ç§’å¤„ç†ä¸Šç™¾ä¸‡è¯·æ±‚çš„ç³»ç»Ÿã€‚

## redisèƒ½åšä»€ä¹ˆ

## redisæ•°æ®ç»“æ„

5ç§ç»“æ„
|ç»“æ„ç±»å‹|å­˜å‚¨çš„å€¼|è¯»å†™èƒ½åŠ›|
|-------|-------|------|
|string(å­—ç¬¦ä¸²)|å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°|å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œï¼›å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è‡ªå‡æ“ä½œ|
|list(åˆ—è¡¨)  |ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²|ä»é“¾è¡¨ä¸¤ç«¯æ¨å…¥æˆ–å¼¹å‡ºå…ƒç´ ï¼›æ ¹æ®åç§»é‡å¯¹é“¾è¡¨è¿›è¡Œtrim;è¯»å–å•ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æŸ¥æ‰¾æˆ–ç§»é™¤å…ƒç´ |
|set(é›†åˆ)   |åŒ…å«å­—ç¬¦ä¸²çš„æ— åºæ”¶é›†å™¨(unordered collection), å¹¶ä¸”è¢«åŒ…å«çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ç‹¬ä¸€æ— äºŒã€å„ä¸ç›¸åŒçš„|æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼›è®¡ç®—äº¤é›†ï¼Œå¹¶é›†ï¼Œå·®é›†ï¼›ä»é›†åˆé‡Œéšæœºè·å–å…ƒç´ |
|hash(æ•£åˆ—)  |åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨|æ·»åŠ ã€è·å–ç§»é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€æœ‰é”®å€¼å¯¹|
|zset(æœ‰åºé›†åˆ)|å­—ç¬¦ä¸²æˆå‘˜(member)ä¸æµ®ç‚¹æ•°åˆ†å€¼(score)ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼Œå…ƒç´ çš„æ’åˆ—ä¹¦åºæœ‰åˆ†å€¼å¤§å°å†³å®š|æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´(range)æˆ–æˆå‘˜æ¥è·å–å…ƒç´ |

## string

å½¢å¦‚: `hello: world`

set, get, del ä½¿ç”¨ç¤ºä¾‹

```bash
set hello world
get hello
del hello
get hello
```

> å‘½ä»¤è¿”å›1è¡¨ç¤ºæˆåŠŸæ‰§è¡Œï¼Œ 0è¡¨ç¤ºæ‰§è¡Œå¤±è´¥

## list åˆ—è¡¨

ä¸€ä¸ªåˆ—è¡¨ç»“æ„å¯ä»¥æœ‰åºçš„å­˜å‚¨å¤šä¸ªå­—ç¬¦ä¸²ï¼Œ**åˆ—è¡¨å¯ä»¥åŒ…å«ç›¸åŒçš„å…ƒç´ **
å½¢å¦‚: `list-key: [item, item2, item]`

åˆ—è¡¨å‘½ä»¤
|å‘½ä»¤|è¡Œä¸º|
|---|----|
|lpush  |å°†å…ƒç´ æ¨å…¥åˆ—è¡¨å·¦ç«¯(left end)|
|rpush  |            ...å³ç«¯(right end)|
|lpop   |ä»åˆ—è¡¨å·¦ç«¯å¼¹å‡ºå…ƒç´ |
|rpop   |ä»å³ç«¯å¼¹å‡ºå…ƒç´   |
|lrange key start stop |è·å–åˆ—è¡¨ç»™å®šèŒƒå›´æ‰€æœ‰å€¼, æ”¯æŒè´Ÿç´¢å¼•, -1è¡¨ç¤ºæœ€å³è¾¹ç¬¬ä¸€ä¸ªå…ƒç´ |
|llen key| è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°,æ—¶é—´å¤æ‚åº¦ä¸ºO(1)|
|lrem key count value| åˆ é™¤åˆ—è¡¨ä¸­å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ ,è¿”å›å€¼æ˜¯å®é™…åˆ é™¤çš„ä¸ªæ•°|
|lindex |è·å–åˆ—è¡¨åœ¨ç»™å®šä½ç½®çš„å•ä¸ªå…ƒç´ |
|lset key index value| å°†ç´¢å¼•ä¸ºindexçš„å…ƒç´ èµ‹å€¼ä¸ºvalue|
|ltrim key start end| åˆ é™¤æŒ‡å®šç´¢å¼•èŒƒå›´ä¹‹å¤–çš„æ‰€æœ‰å…ƒç´ |
|linsert key BEFORE|AFTER pivot value| ä»å·¦å¾€å³æŸ¥æ‰¾å€¼ä¸ºpivotçš„å…ƒç´ ï¼Œæ ¹æ®ç¬¬äºŒä¸ªå‚æ•°æ˜¯beforeè¿˜æ˜¯afteræ¥å†³å®šå°†valueæ’å…¥åˆ°è¯¥å…ƒç´ å‰é¢è¿˜æ˜¯åé¢|
|rpoplpush source destination| å°†å…ƒç´ ä»ä¸€ä¸ªåˆ—è¡¨è½¬åˆ°å¦ä¸€ä¸ªåˆ—è¡¨|

è¯´æ˜:

> count > 0, lremä»åˆ—è¡¨å·¦è¾¹å¼€å§‹åˆ é™¤å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ 
> count < 0, lremä»åˆ—è¡¨å³è¾¹å¼€å§‹åˆ é™¤å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ 
> count = 0, lremåˆ é™¤æ‰€æœ‰å€¼ä¸ºvalueçš„å…ƒç´ 
> ltrimå’Œlpushä¸€èµ·ä½¿ç”¨æ¥é™åˆ¶åˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—åªä¿ç•™æœ€è¿‘100æ¡ï¼Œæ¯æ¬¡åŠ å…¥å…ƒç´ æ—¶è°ƒç”¨ä¸€æ¬¡ltrim

```bash
lpush logs $newLogs
ltrim logs 0 99
```

```bash
lpush numbers 1
# æ”¯æŒåŒæ—¶å¢åŠ å¤šä¸ªå…ƒç´ 
lpush numbers 2 3
# æ­¤æ—¶æ•°æ®ä¸º[3, 2, 1]
rpush numbers 0 -1
# æ­¤æ—¶æ•°æ®ä¸º[3, 2, 1, 0, -1]

lpop numbers # 3

rpop numbers # -1

llen numbers # 3

lrange numbers 0 -1 # è·å–æ‰€æœ‰å…ƒç´ 

lrem
lindex list-key 1


```

æƒ³æŠŠåˆ—è¡¨å½“æ ˆä½¿ç”¨, ç”¨ `lpush` å’Œ `lpop` æˆ– `rpush`å’Œ `rpop`
æƒ³å½“é˜Ÿåˆ—ä½¿ç”¨, ç”¨ `lpush` å’Œ `rpop` æˆ– `rpush` å’Œ `lpop`

## set é›†åˆ

é›†åˆé€šè¿‡æ•£åˆ—è¡¨ä¿è¯è‡ªå·±**å­˜å‚¨çš„æ¯ä¸ªå­—ç¬¦ä¸²æ˜¯å„ä¸ç›¸åŒçš„**(è¿™äº›æ•£åˆ—è¡¨åªæœ‰é”®ï¼Œæ²¡æœ‰ä¸é”®ç›¸å…³è”çš„å€¼)

é›†åˆä¸åˆ—è¡¨å¯¹æ¯”
|å¯¹æ¯”é¡¹|é›†åˆ|æ•£åˆ—|
|--|----|---|
|å­˜å‚¨å†…å®¹|è‡³å¤š2(32)-1ä¸ªå­—ç¬¦ä¸²|è‡³å¤š2(32)-1ä¸ªå­—ç¬¦ä¸²|
|æœ‰åºæ€§|å¦|æ˜¯|
|å”¯ä¸€æ€§|æ˜¯|å¦|

é›†åˆä½¿ç”¨æ— åº(unordered)æ–¹å¼å­˜å‚¨å…ƒç´ .
å½¢å¦‚: `setkey: [item, item2, item3]`

é›†åˆç±»å‹åœ¨Rediså†…éƒ¨æ˜¯ä½¿ç”¨å€¼ä¸ºç©ºçš„æ•£åˆ—è¡¨(hash table)å®ç°çš„

å¸¸ç”¨æ“ä½œæ˜¯åŠ å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œåˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ç­‰ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)

å¤šä¸ªé›†åˆç±»å‹é”®ä¹‹é—´è¿˜å¯ä»¥è¿›è¡Œå¹¶é›†ï¼Œäº¤é›†å’Œå·®é›†è¿ç®—

é›†åˆå‘½ä»¤
|å‘½ä»¤|è¡Œä¸º|
|---|----|
|sadd       |å°†ç»™å®šå…ƒç´ æ·»åŠ åˆ°é›†åˆ|
|smembers   |è¿”å›é›†åˆæ‰€æœ‰å…ƒç´ (æ…¢ï¼Œæ…ç”¨)|
|sismember  |æ£€æŸ¥ç»™å®šå…ƒç´ æ˜¯å¦å­˜åœ¨|
|srem       |å¦‚æœç»™å®šå…ƒç´ å­˜åœ¨ï¼Œç§»é™¤|

```bash
sadd setkey item
sadd setkey item2
sadd setkey item3
sadd setkey item // å¤±è´¥
smembers setkey
sismember setkey item4
sismember setkey item
srem setkey item2
srem setkey item2

```

## hash æ•£åˆ—

æ•£åˆ—å¯ä»¥å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹ä¹‹é—´çš„æ˜ å°„ï¼Œå’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œæ—¢å¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯æ•°å­—å€¼ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æ•£åˆ—å­˜å‚¨çš„æ•°å­—å€¼æ‰§è¡Œè‡ªå¢è‡ªå‡æ“ä½œã€‚

æ•£åˆ—å¾ˆå¤šå½“é¢åƒä¸€ä¸ªå¾®ç¼©ç‰ˆçš„redisï¼Œä¸å°‘å­—ç¬¦ä¸²å‘½ä»¤éƒ½æœ‰ç›¸åº”çš„æ•£åˆ—ç‰ˆæœ¬ã€‚

å½¢å¦‚ï¼š`hashset: [{subkey1: value1},{subkey2: value2},{subkey3: value3},]`

æ•£åˆ—å‘½ä»¤
|å‘½ä»¤|  è¡Œä¸º|
|---|------|
|hset   |åœ¨æ•£åˆ—é‡Œå…³è”ç»™å®šçš„é”®å€¼å¯¹|
|hget   |è·å–ç»™å®šæ•£åˆ—é”®çš„å€¼|
|hgetall|è·å–æ•£åˆ—æ‰€æœ‰é”®å€¼å¯¹|
|hdel   |å¦‚æœé”®å­˜åœ¨ï¼Œç§»é™¤|

```bash
hset hashkey subkey1 value1
hset hashkey subkey2 value2
hset hashkey subkey3 value3
hgetall hashkey
hdel hashkey subkey2
hdel hashkey subkey2
hdel hashkey subkey1
hgetall hashkey
```

## zset æœ‰åºé›†åˆ

æœ‰åºé›†åˆå’Œæ•£åˆ—ä¸€æ ·ï¼Œéƒ½ç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼Œæœ‰åºé›†åˆçš„é”®å€¼è¢«ç§°ä¸ºæˆå‘˜(member)ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æ˜¯å„ä¸ç›¸åŒçš„ï¼›
è€Œæœ‰åºé›†åˆçš„å€¼è¢«ç§°ä¸ºåˆ†å€¼(score)ï¼Œåˆ†å€¼å¿…é¡»ä¸ºæµ®ç‚¹æ•°ã€‚
æœ‰åºé›†åˆæ˜¯Redisé‡Œå”¯ä¸€ä¸€ä¸ªæ—¢å¯ä»¥æ ¹æ®æˆå‘˜è®¿é—®å…ƒç´ ï¼Œåˆå¯ä»¥æ ¹æ®åˆ†å€¼åŠåˆ†å€¼çš„æ’åºé¡ºåºæ¥è®¿é—®å…ƒç´ çš„ç»“æ„

æœ‰åºé›†åˆå’Œåˆ—è¡¨ç±»å‹åŒºåˆ«

ç›¸åŒç‚¹:

1. éƒ½æ˜¯æœ‰åºçš„
2. éƒ½å¯ä»¥è·å¾—æŸä¸€èŒƒå›´çš„å…ƒç´ 

ä¸åŒç‚¹:

1. åˆ—è¡¨é€šè¿‡é“¾è¡¨å®ç°ï¼Œè·å–é è¿‘ä¸¤ç«¯çš„æ•°æ®é€Ÿåº¦æå¿«ï¼Œå½“å…ƒç´ å¢å¤šï¼Œè®¿é—®ä¼šå˜æ…¢ï¼Œæ‰€ä»¥æ›´é€‚åˆå®ç°å¦‚'æ–°é²œäº‹'æˆ–'æ—¥å¿—'è¿™æ ·å¾ˆå°‘è®¿é—®ä¸­é—´å…ƒç´ çš„åº”ç”¨
2. æœ‰åºé›†åˆç±»å‹æ˜¯ä½¿ç”¨æ•£åˆ—è¡¨å’Œè·³è·ƒè¡¨(Skip list)å®ç°çš„ï¼ŒåŠæ—¶è¯»å–ä¸­é—´éƒ¨åˆ†çš„æ•°æ®é€Ÿåº¦ä¹Ÿå¾ˆå¿«(æ—¶é—´å¤æ‚åº¦O(log(N)))
3. åˆ—è¡¨ä¸­ä¸èƒ½ç®€å•çš„è°ƒæ•´æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½†æœ‰åºé›†åˆå¯ä»¥(é€šè¿‡æ›´æ”¹è¿™ä¸ªå…ƒç´ çš„åˆ†æ•°)
4. æœ‰åºé›†åˆæ¯”åˆ—è¡¨ç±»å‹æ›´è€—å†…å­˜

### æœ‰åºé›†åˆå‘½ä»¤

|å‘½ä»¤|è¡Œä¸º|
|---|----|
|zadd   |å°†å¸¦æœ‰ç»™å®šåˆ†å€¼çš„æˆå‘˜æ·»åŠ åˆ°æœ‰åºé›†åˆé‡Œ|
|zrange |æ ¹æ®å…ƒç´ åœ¨æœ‰åºæ’åˆ—ä¸­æ‰€å¤„çš„ä½ç½®ï¼Œä»æœ‰åºé›†åˆæè·å–å¤šå°‘ä¸ªå…ƒç´ |
|zrangebyscore|è·å–æœ‰åºé›†åˆåœ¨ç»™å®šåˆ†å€¼èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ |
|zrem   |å¦‚æœç»™å®šæˆå‘˜å­˜åœ¨ï¼Œç§»é™¤|

```bash
zadd zsetkey 728 member1
zadd zsetkey 928 member0
zadd zsetkey 928 member0

zrange zsetkey 0 -1 withscores
zrangebyscore zsetkey 0 800 withscores

zrem zsetkey member1
zrem zsetkey member1

zrange zsetkey 0 -1 withscores
```
