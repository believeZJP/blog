---
title: 小程序开发积累
date: 2018-12-12 11:28:49
updated: 2018-12-12 11:28:49
tags:
    - 小程序
    - 经验积累
---

# 小程序开发经验积累

## js判断小程序环境

小程序内置web-view引入页面时，
[官方文档](https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html)建议通过 `window.__wxjs_environment === 'miniprogram'` 判断小程序环境。经测试在安卓有些设备上会失效。

`wx.miniProgram.getEnv`也会失效
```JavaScript
wx.miniProgram.getEnv(function(res) {
    if (res.miniProgram) {
        // 走在小程序的逻辑
        alert("小程序环境" + window.__wxjs_environment);
    }
});
```

### 解决方案
通过userAgent 判断
`const isMiniProgram = /miniProgram/i.test(navigator.userAgent.toLowerCase());`


## UserAgent 详解

通过UA来判断不同的设备或浏览器是开发者最常用的方法

**在控制台打印`navigator.userAgent`查看**

> Android 系统下的微信 User Agent

```JavaScript
Mozilla/5.0 (Linux; Android 7.1.1; MI 6 Build/NMF26X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.132 MQQBrowser/6.2 TBS/043807 Mobile Safari/537.36 MicroMessenger/6.6.1.1220(0x26060135) NetType/WIFI Language/zh_CN
```

> iPhone 系统下的微信 User Agent
```JavaScript
Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_2 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13F69 MicroMessenger/6.6.1 NetType/4G Language/zh_CN
```

> 微信内置浏览器与小程序中的User Agent 对比

```JavaScript
// 安卓系统中小程序 User Agent
Mozilla/5.0 (Linux; Android 7.1.1; MI 6 Build/NMF26X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.132 MQQBrowser/6.2 TBS/043807 Mobile Safari/537.36 MicroMessenger/6.6.1.1220(0x26060135) NetType/4G Language/zh_CN MicroMessenger/6.6.1.1220(0x26060135) NetType/4G Language/zh_CN miniProgram
// 安卓系统中微信内置浏览器 User Agent
Mozilla/5.0 (Linux; Android 7.1.1; MI 6 Build/NMF26X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.132 MQQBrowser/6.2 TBS/043807 Mobile Safari/537.36 MicroMessenger/6.6.1.1220(0x26060135) NetType/4G Language/zh_CN
```

以上字符串为MI6安卓设备中获得。可以看出微信小程的UA和微信内置浏览器UA是不同的，特别是最后的'miniProgram'字符串。而在iPhone系统设备中UA是一致的， 小程序和微信内置浏览器UA没有区别。


### UA检测和判断方法
```JavaScript
if (/MicroMessenger/i.test(navigator.userAgent)) {
    console.log('当前为微信访问');
}
```

## 开源工具推荐:
[UAParser.js](https://github.com/faisalman/ua-parser-js)

目前生产环境使用该库来判断移动，Android，iOS等环境。

## 小程序里一定要用https, 无法访问http

解决办法：配置Charles
https://www.cnblogs.com/xcsn/p/7538371.html 

## 小程序生命周期
onload ---->  onshow  ---->  onready
即使在onload阶段发生跳转，后面的流程还是会继续执行。

原则上onload 只会执行一次，onshow每次页面显示才会显示。

所有页面onload阶段的options是从跳转的page url后跟的参数取到的。


## 组件button样式

button去掉边框
```css
.btn{
	backgrond:none;
}
.btn::after{
	border: none;
}
```

## button 阻止冒泡

有的button 设置了默认操作例如open-type='share'
点击以后父容器有click事件，也会触发。

解决办法：
在button绑定一个方法 return false;
