---
title: 前端性能的监控和优化
date: 2019-03-28 15:32:28
updated: 2019-03-28 15:32:28
tags:
- 前端
- 性能优化
- 监控
---

# 目标

* 理解性能监控和优化的一般方法
* 移动端的性能
* 运用工具来监控和优化

## 性能优化的重要性

    1. 性能和PV直接相关
    2. 性能与收入有关
    3. 前端容易产生性能的瓶颈
    4. 无线设备性能问题更明显

反面案例: 百科某次上线，性能下降20% ====> PV流失近15%====> 收入下降10%

移动端更严重
DOM ready时间： wifi 2.3s, 3G/4G 4.2s, 2G 首字节5-6s， 8s+

### 一、何为前端性能

打开一个网站，需要经过多少步

性能优化的一般思路

1. 减少请求次数
2. 减少请求体积
3. 加快请求速度
4. 缩短渲染时间

## 二、指标的确定、采集和分析

### 基于用户角度的关键指标选取

1. 页面打不开 -- 白屏时间(DNS查询，TCP连接，发送请求，等待响应)
2. 页面显示不出来 -- 首屏时间(html传输，静态资源下载)
3. 按钮点击不了 -- 用户可操作(解析文档，执行JS/CSS规则，计算布局)
4. 图片显示慢 -- 页面总下载(渲染完成)

### 怎么采集展示？

页面打开的时间起点到页面渲染完成的时间各阶段时间分布，总占比

### 数据波动

波动即意味着性能发生变化，需要注意

### 占比更重要

总下载的时间，各阶段的用户下载占比(很快0-2，较快2-4，可接受4-8，很慢8+)

#### 数据采集-首屏时间

    图片是制约首屏的主要因素

    获取首屏图片的加载耗时即可获取大概首屏时间

##### 首屏统计流程

1. 首屏大概位置执行统计JS
2. 绑定所有图片加载事件
3. 页面onload之后找到最慢一张图片加载时间

#### 数据采集- 可操作时间

    DomReady或核心JS加载完毕

#### 数据采集-总下载时间

    onload or 异步渲染完成

### 浏览器性能API

[Performance Timing](https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceTiming)

[Resource Timing](https://developer.mozilla.org/zh-CN/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API)

## 三、常用的优化方法

1. 雅虎性能优化军规
2. 可优化的点
   1. DNS查询
      1. DNS缓存(浏览器、操作系统)
      2. 减少DNS数(一个页面不超过4个, DNS预查询dns-prefetch)
   2. 建立连接
      1. 使用CDN 提速10%-20%(缩短距离，降低连接时间)
   3. 发送请求
      1. 减少HTTP请求(打包JS，CSS文件，图片合并)
      2. Keep alive 减少TCP请求连接数
   4. 内容传输
      1. 文件压缩(js, css, html),代码混淆 60%+
      2. 代码精简 减少无用代码，提高质量
      3. gzip



## 四、极致的性能优化

## 五、移动端的性能
